#!/bin/bash
set -e

db=kecs
name="name"

while [ $# -gt 0 ]; do
    case $1 in
        -n) name=$2 && shift 2;;
        *)  break;;
    esac
done

file=$1
tbl=$2

spec=$(colspec -v $name $file)

sql="\
LOAD DATA LOCAL INFILE '$file'
IGNORE INTO TABLE $tbl
FIELDS TERMINATED BY ',' ENCLOSED BY '\"' ESCAPED BY '\"'
LINES TERMINATED BY '\\n'
IGNORE 1 LINES
($spec)
SET
    name = @$name;
"

mysql $db <<< $sql